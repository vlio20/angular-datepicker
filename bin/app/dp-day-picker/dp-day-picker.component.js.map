{"version":3,"sources":["../src/app/dp-day-picker/dp-day-picker.component.ts"],"names":[],"mappings":"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","file":"dp-day-picker.component.js","sourcesContent":["import {\n  Component,\n  Input,\n  HostListener,\n  forwardRef,\n  SimpleChanges,\n  OnChanges,\n  OnInit\n} from '@angular/core';\nimport {ObCalendarComponent} from '../dp-calendar/dp-calendar.component';\nimport * as moment from 'moment';\nimport {Moment} from 'moment';\nimport {DayPickerService} from './service/day-picker.service';\nimport {IDayPickerConfig} from './service/day-picker-config.model';\nimport {ICalendarConfig} from '../dp-calendar/config/calendar-config.model';\nimport {ControlValueAccessor, NG_VALUE_ACCESSOR, FormControl, NG_VALIDATORS, Validator} from '@angular/forms';\nimport {UtilsService} from '../common/services/utils/utils.service';\nimport {IObDayPickerApi} from './dp-day-picker.api';\n\n@Component({\n  selector: 'dp-day-picker',\n  templateUrl: './dp-day-picker.component.html',\n  styleUrls: ['./dp-day-picker.component.less'],\n  entryComponents: [ObCalendarComponent],\n  providers: [\n    DayPickerService,\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => DpDayPickerComponent),\n      multi: true\n    },\n    {\n      provide: NG_VALIDATORS,\n      useExisting: forwardRef(() => DpDayPickerComponent),\n      multi: true\n    }\n  ]\n})\nexport class DpDayPickerComponent implements OnChanges, OnInit, ControlValueAccessor, Validator {\n  private shouldNgInit: boolean = true;\n  @Input('config') private userConfig: IDayPickerConfig;\n\n  // attributes\n  @Input() private placeholder: string = '';\n  @Input() private disabled: boolean = false;\n\n  // validations\n  @Input() private minDate: Moment | string;\n  @Input() private maxDate: Moment | string;\n\n  private areCalendarsShown: boolean = false;\n  private hideStateHelper: boolean = false;\n  private pickerConfig: IDayPickerConfig;\n  private calendars: ICalendarConfig[];\n  private _value: Moment;\n  private userValue;\n  private viewValue: string;\n  private userValueType: string = 'object';\n  validateFn: Function;\n\n  private get value(): Moment {\n    return this._value;\n  }\n\n  private set value(value: Moment) {\n    this._value = value;\n    this.viewValue = value ? value.format(this.pickerConfig.format) : '';\n    const val = this.userValueType === 'string' ? this.viewValue : value;\n    if (this.value) {\n      this.calendars = this.dayPickerService.moveCalendars(this.pickerConfig, this.value, this.value, 0);\n    }\n    this.onChangeCallback(val);\n  }\n\n  api: IObDayPickerApi = <IObDayPickerApi>{};\n\n  constructor(private dayPickerService: DayPickerService) {\n  }\n\n  @HostListener('click')\n  onClick() {\n    this.hideStateHelper = true;\n  }\n\n  @HostListener('document:click')\n  onBodyClick() {\n    if (!this.hideStateHelper) {\n      this.hideCalendars();\n    }\n    this.hideStateHelper = false;\n  }\n\n  ngOnInit() {\n    if (this.shouldNgInit) {\n      this.init();\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    this.shouldNgInit = false;\n    const {minDate, maxDate} = changes;\n    this.init();\n\n    if (minDate || maxDate) {\n      this.initValidators();\n    }\n  }\n\n  writeValue(value: Moment): void {\n    if (value) {\n      this.userValueType = typeof value;\n      this.userValue = value;\n      this.init();\n    }\n  }\n\n  onChangeCallback(_: any) {\n  };\n\n  registerOnChange(fn: any): void {\n    this.onChangeCallback = fn;\n  }\n\n  registerOnTouched(fn: any): void {\n  }\n\n  validate(c: FormControl) {\n    if (this.minDate || this.maxDate) {\n      return this.validateFn(c);\n    } else {\n      return () => null;\n    }\n  }\n\n  isDateValid(value: string) {\n    if (this.dayPickerService.isDateValid(value, this.pickerConfig.format)) {\n      this.value = moment(value, this.pickerConfig.format);\n    } else {\n      this.value = null;\n    }\n  }\n\n  // start\n  init() {\n    this.pickerConfig = this.dayPickerService.getConfig(this.userConfig);\n    this.value = this.userValue ? UtilsService.convertToMoment(this.userValue, this.pickerConfig.format) : this.value;\n    this.calendars = this.dayPickerService.generateCalendars(this.pickerConfig, this.value);\n    this.initApi();\n  }\n\n  initValidators() {\n    this.validateFn = this.dayPickerService.createValidator({\n      minDate: typeof this.minDate === 'string' ?\n        moment(<string>this.minDate, this.pickerConfig.format) : <Moment>this.minDate,\n      maxDate: typeof this.maxDate === 'string' ?\n        moment(<string>this.maxDate, this.pickerConfig.format) : <Moment>this.maxDate\n    }, this.pickerConfig.format);\n    this.onChangeCallback(this.viewValue);\n  }\n\n  initApi() {\n    this.api = {\n      open: this.showCalendars.bind(this),\n      close: this.hideCalendars.bind(this)\n    };\n  }\n\n  daySelected({day}) {\n    this.value = day.date;\n\n    if (this.pickerConfig.closeOnSelect) {\n      setTimeout(this.hideCalendars, this.pickerConfig.closeOnSelectDelay);\n    }\n  }\n\n  inputFocused() {\n    this.hideStateHelper = false;\n    this.areCalendarsShown = true;\n  }\n\n  showCalendars = () => {\n    this.hideStateHelper = true;\n    this.areCalendarsShown = true;\n  };\n\n  hideCalendars = () => {\n    this.areCalendarsShown = false;\n  };\n\n  moveCalendars(base: Moment, months: number) {\n    this.calendars = this.dayPickerService.moveCalendars(this.pickerConfig, this.value, base, months);\n  }\n\n  isLeftNavDisabled(month: Moment): boolean {\n    return this.dayPickerService.isMinMonth(<Moment>this.pickerConfig.min, month);\n  }\n\n  isRightNavDisabled(month: Moment): boolean {\n    return this.dayPickerService.isMaxMonth(<Moment>this.pickerConfig.max, month);\n  }\n\n  onViewDateChange(date: string) {\n    if (this.dayPickerService.isDateValid(date, this.pickerConfig.format)) {\n      this.value = date !== '' ? moment(date, this.pickerConfig.format) : null;\n\n    } else {\n      this.onChangeCallback(undefined);\n    }\n  }\n\n  onKeydown(e: KeyboardEvent) {\n    if (e.keyCode === 13) {\n      this.areCalendarsShown = !this.areCalendarsShown;\n      e.preventDefault();\n    }\n\n    if (e.keyCode === 27) {\n      this.areCalendarsShown = false;\n      e.preventDefault();\n    }\n\n    if (this.pickerConfig.disableKeypress) {\n      e.preventDefault();\n    }\n  }\n}\n"]}